-- Mini Purple 3D UI + Key + KillAllAndRejoin Feature
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")

-- ================== ฟังก์ชัน KillAllAndRejoin ==================
local SavedPosition = nil 
local AttackDuration = 3

local WeaponNameEncoded = "\224\184\161\224\184\181\224\184\148\224\184\158\224\184\129"
local Weapon = LocalPlayer.Backpack:WaitForChild(WeaponNameEncoded) or LocalPlayer.Character:WaitForChild(WeaponNameEncoded)
if not Weapon then warn("Weapon not found.") return end
local AttackRemote = Weapon:WaitForChild("FEMeleeKitEvents"):WaitForChild("Attack"):WaitForChild("Attack_Server")
if not AttackRemote then warn("Attack_Server RemoteEvent not found.") end

local BaseArgs = {
    nil, Weapon:WaitForChild("Handle"),
    [4] = { AttackDelay = 0.001, AnimationTable = { {ID = "rbxassetid://79412744323332", speed = {0.8}, hitboxTimes = {0, 4}, animationType = "Attack"}, },
        BaseDamage = {99999, 99999}, Handle1Hitbox = true, Handle2Hitbox = false,
    },
    [5] = 3
}

local IsAttacking = false
local Connection = nil
local AttackInterval = 0.001

local function InstantAttackAllTargets()
    local Targets = {}
    for _, Player in ipairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild("Humanoid") and Player.Character.Humanoid.Health > 0 then
            table.insert(Targets, Player.Character)
        end
    end
    for _, TargetCharacter in ipairs(Targets) do
        BaseArgs[1] = TargetCharacter 
        AttackRemote:FireServer(unpack(BaseArgs))
    end
    task.wait(AttackInterval) 
end

local function KillAllAndRejoinCycle(ToggleButton)
    local Character = LocalPlayer.Character
    local HRP = Character and Character:FindFirstChild("HumanoidRootPart")
    if IsAttacking or not HRP then return end
    IsAttacking = true
    SavedPosition = HRP.CFrame
    
    ToggleButton.Text = "SAVED POSITION. RUNNING KILL ALL... (" .. AttackDuration .. "s)"
    ToggleButton.BackgroundColor3 = Color3.new(1, 1, 0)

    Connection = RunService.Heartbeat:Connect(InstantAttackAllTargets)
    task.wait(AttackDuration)

    if Connection then
        Connection:Disconnect()
        Connection = nil
    end

    ToggleButton.Text = "TELEPORTING (REJOINING)"
    ToggleButton.BackgroundColor3 = Color3.new(0, 0, 1)

    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end

LocalPlayer.CharacterAdded:Connect(function(Character)
    local HRP = Character:WaitForChild("HumanoidRootPart", 10)
    if HRP and SavedPosition then
        task.wait(0.5)
        HRP.CFrame = SavedPosition
        SavedPosition = nil
        warn("Successfully warped back to saved position.")
    end
end)

-- ================== Mini Purple 3D UI + Key System ==================
local MiniUI = {}
MiniUI.__index = MiniUI

local KEY_CODE = "dualhub"
local UserInputService = game:GetService("UserInputService")

local function styleFrame(frame)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = frame

    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(80, 40, 100)
    stroke.Thickness = 2
    stroke.Parent = frame

    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(90, 40, 150)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 70, 220))
    }
    gradient.Rotation = 90
    gradient.Parent = frame

    local shadow = Instance.new("Frame")
    shadow.Size = UDim2.new(1,4,1,4)
    shadow.Position = UDim2.new(0,-2,0,-2)
    shadow.BackgroundColor3 = Color3.fromRGB(40, 20, 90)
    shadow.BorderSizePixel = 0
    shadow.ZIndex = frame.ZIndex - 1
    shadow.Parent = frame
end

local function styleCloseButton(btn)
    btn.BackgroundColor3 = Color3.fromRGB(180, 50, 150)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = "X"

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn

    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 100, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 50, 150))
    }
    gradient.Rotation = 45
    gradient.Parent = btn

    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(255, 180, 255)
    stroke.Thickness = 2
    stroke.Parent = btn

    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(255, 80, 255)
        btn.Position = btn.Position + UDim2.new(0,0,0,-2)
    end)
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(180, 50, 150)
        btn.Position = btn.Position + UDim2.new(0,0,0,2)
    end)
end

function MiniUI:CreateWindow(title)
    local player = game.Players.LocalPlayer
    local gui = Instance.new("ScreenGui")
    gui.Name = "MiniUI"
    gui.ResetOnSpawn = false
    gui.Parent = player:WaitForChild("PlayerGui")

    local keyFrame = Instance.new("Frame")
    keyFrame.Size = UDim2.new(0, 300, 0, 150)
    keyFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
    keyFrame.BackgroundColor3 = Color3.fromRGB(60, 30, 90)
    keyFrame.BorderSizePixel = 0
    keyFrame.Parent = gui
    styleFrame(keyFrame)

    local keyLabel = Instance.new("TextLabel")
    keyLabel.Size = UDim2.new(1, -20, 0, 40)
    keyLabel.Position = UDim2.new(0, 10, 0, 10)
    keyLabel.BackgroundTransparency = 1
    keyLabel.Text = "Enter Key to Access UI"
    keyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyLabel.Font = Enum.Font.GothamBold
    keyLabel.TextSize = 20
    keyLabel.Parent = keyFrame

    local keyBox = Instance.new("TextBox")
    keyBox.Size = UDim2.new(1, -40, 0, 40)
    keyBox.Position = UDim2.new(0, 10, 0, 60)
    keyBox.PlaceholderText = "Enter Key Here..."
    keyBox.BackgroundColor3 = Color3.fromRGB(100, 50, 150)
    keyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyBox.Font = Enum.Font.Gotham
    keyBox.TextSize = 18
    keyBox.ClearTextOnFocus = false
    keyBox.Parent = keyFrame

    local enterBtn = Instance.new("TextButton")
    enterBtn.Size = UDim2.new(0, 80, 0, 35)
    enterBtn.Position = UDim2.new(1, -90, 1, -45)
    enterBtn.BackgroundColor3 = Color3.fromRGB(120, 60, 200)
    enterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    enterBtn.Font = Enum.Font.GothamBold
    enterBtn.TextSize = 18
    enterBtn.Text = "Enter"
    enterBtn.Parent = keyFrame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = enterBtn

    local function showMainUI()
        keyFrame:Destroy()
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 250, 0, 180)
        frame.Position = UDim2.new(0.5, -125, 0.5, -90)
        frame.BackgroundColor3 = Color3.fromRGB(90, 40, 160)
        frame.BorderSizePixel = 0
        frame.Parent = gui
        styleFrame(frame)

        local titleLabel = Instance.new("TextLabel")
        titleLabel.Size = UDim2.new(1, -30, 0, 30)
        titleLabel.Position = UDim2.new(0, 0, 0, 0)
        titleLabel.BackgroundTransparency = 1
        titleLabel.Text = title
        titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        titleLabel.Font = Enum.Font.GothamBold
        titleLabel.TextSize = 18
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.Parent = frame

        local closeBtn = Instance.new("TextButton")
        closeBtn.Size = UDim2.new(0, 30, 0, 30)
        closeBtn.Position = UDim2.new(1, -30, 0, 0)
        closeBtn.Parent = frame
        styleCloseButton(closeBtn)
        closeBtn.MouseButton1Click:Connect(function()
            gui:Destroy()
        end)

        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -10, 1, -50)
        container.Position = UDim2.new(0, 5, 0, 35)
        container.BackgroundTransparency = 1
        container.Parent = frame

        local dragging, dragInput, mousePos, framePos = false
        titleLabel.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                mousePos = input.Position
                framePos = frame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)
        titleLabel.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                local delta = input.Position - mousePos
                frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
            end
        end)

        self.Frame = frame
        self.Container = container
    end

    enterBtn.MouseButton1Click:Connect(function()
        if keyBox.Text == KEY_CODE then
            showMainUI()
        else
            keyBox.Text = ""
            keyBox.PlaceholderText = "Wrong Key!"
        end
    end)
end

function MiniUI:Button(text, callback)
    if not self.Container then return end
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 30)
    btn.BackgroundColor3 = Color3.fromRGB(120, 60, 200)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.Text = text
    btn.Parent = self.Container

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn

    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(160,80,255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(200,120,255))
    }
    gradient.Rotation = 90
    gradient.Parent = btn

    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(220, 120, 255)
        btn.Position = btn.Position + UDim2.new(0,0,0,-2)
    end)
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(120, 60, 200)
        btn.Position = btn.Position + UDim2.new(0,0,0,2)
    end)

    btn.MouseButton1Click:Connect(callback)
end

-- ================== ใช้งาน ==================
local ui = setmetatable({}, MiniUI)
ui:CreateWindow("Dual Hub Kill all (Kick)")

spawn(function()
    repeat task.wait() until ui.Container
    ui:Button("Kill All & Rejoin ( hold a weapon )", function()
        KillAllAndRejoinCycle(ui.Container.Parent:FindFirstChildWhichIsA("TextButton")) -- ส่งปุ่ม Toggle ให้เปลี่ยนสี/ข้อความ
    end)
end)
